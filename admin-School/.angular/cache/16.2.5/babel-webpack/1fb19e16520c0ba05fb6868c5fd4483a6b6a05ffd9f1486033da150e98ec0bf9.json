{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nexport let ProfileComponent = class ProfileComponent {\n  constructor(route, user, payment, attendanceService) {\n    this.route = route;\n    this.user = user;\n    this.payment = payment;\n    this.attendanceService = attendanceService;\n    this.attonePresent = [];\n    this.attoneAbsent = [];\n    this.attoneLate = [];\n    this.attendancePercentageAllMonths = 0;\n    this.attendancePercentageCurrentMonth = 0;\n    this.attendancePercentageAllMonthsPresent = 0;\n    this.attendancePercentageAllMonthsAbsent = 0;\n    this.attendancePercentageAllMonthsLate = 0;\n    this.attendancePercentageCurrentMonthPresent = 0;\n    this.attendancePercentageCurrentMonthAbsent = 0;\n    this.attendancePercentageCurrentMonthLate = 0;\n    this.data = [];\n    this.attone = [];\n    this.id = '';\n    this.dataType = '';\n    this.payments = [];\n  }\n  ngOnInit() {\n    this.percentageattendance();\n    // const id=this.route.snapshot.paramMap.get(\"id\");\n    this.route.params.subscribe(params => {\n      this.dataType = params['type'];\n      this.id = params['id']; // Will be 'student' or 'employee'\n    });\n\n    this.user.getUserById(this.id).subscribe({\n      next: student => {\n        this.data = student;\n      }\n    });\n    if (this.data === 'Employee') {\n      this.payment.getAllPayments().subscribe(payment => {\n        // Filter users by role 'employee'\n        console.log(this.payments);\n        this.payments = payment.filter(payment => payment.userId === this.id);\n        console.log(this.payments);\n      });\n    } else {\n      this.payment.getAllPayments().subscribe(payment => {\n        // Filter users by role 'student'\n        this.payments = payment.filter(payment => payment.userId === this.id);\n        console.log(this.payments);\n      });\n    }\n  }\n  percentageattendance() {\n    // Fetch all attendance records\n    this.attendanceService.getAllAttendance().subscribe(att => {\n      // Handle the fetched attendance records here\n      this.attone = att.filter(att => att.iduser._id === this.id);\n      // Filter records for the current month\n      const currentDate = new Date();\n      const currentMonth = currentDate.getMonth();\n      const currentYear = currentDate.getFullYear();\n      this.attonePresent = this.attone.filter(atte => {\n        const attDate = new Date(atte.datenow); // Use 'datenow' property for date filtering\n        return attDate.getMonth() === currentMonth && attDate.getFullYear() === currentYear && atte.status === 'present';\n      });\n      this.attoneAbsent = this.attone.filter(atte => {\n        const attDate = new Date(atte.datenow); // Use 'datenow' property for date filtering\n        return attDate.getMonth() === currentMonth && attDate.getFullYear() === currentYear && atte.status === 'absent';\n      });\n      this.attoneLate = this.attone.filter(atte => {\n        const attDate = new Date(atte.datenow); // Use 'datenow' property for date filtering\n        return attDate.getMonth() === currentMonth && attDate.getFullYear() === currentYear && atte.status === 'late';\n      });\n      // Calculate attendance percentages\n      const totalRecordsAllMonths = this.attone.length;\n      const totalRecordsCurrentMonth = this.attonePresent.length + this.attoneAbsent.length + this.attoneLate.length;\n      if (totalRecordsAllMonths > 0) {\n        this.attendancePercentageAllMonthsPresent = this.attonePresent.length / totalRecordsAllMonths * 100;\n        this.attendancePercentageAllMonthsAbsent = this.attoneAbsent.length / totalRecordsAllMonths * 100;\n        this.attendancePercentageAllMonthsLate = this.attoneLate.length / totalRecordsAllMonths * 100;\n      }\n      if (totalRecordsCurrentMonth > 0) {\n        this.attendancePercentageCurrentMonthPresent = this.attonePresent.length / totalRecordsCurrentMonth * 100;\n        this.attendancePercentageCurrentMonthAbsent = this.attoneAbsent.length / totalRecordsCurrentMonth * 100;\n        this.attendancePercentageCurrentMonthLate = this.attoneLate.length / totalRecordsCurrentMonth * 100;\n      }\n      console.log('Attendance Records for All Months:', this.attone);\n      console.log('Attendance Records for Current Month (Present):', this.attonePresent);\n      console.log('Attendance Records for Current Month (Absent):', this.attoneAbsent);\n      console.log('Attendance Records for Current Month (Late):', this.attoneLate);\n      console.log('Attendance Percentage for All Months (Present):', this.attendancePercentageAllMonthsPresent);\n      console.log('Attendance Percentage for All Months (Absent):', this.attendancePercentageAllMonthsAbsent);\n      console.log('Attendance Percentage for All Months (Late):', this.attendancePercentageAllMonthsLate);\n      console.log('Attendance Percentage for Current Month (Present):', this.attendancePercentageCurrentMonthPresent);\n      console.log('Attendance Percentage for Current Month (Absent):', this.attendancePercentageCurrentMonthAbsent);\n      console.log('Attendance Percentage for Current Month (Late):', this.attendancePercentageCurrentMonthLate);\n    }, error => {\n      console.error('Error fetching attendance records:', error);\n    });\n  }\n};\nProfileComponent = __decorate([Component({\n  selector: 'app-profile',\n  templateUrl: './profile.component.html',\n  styleUrls: ['./profile.component.css']\n})], ProfileComponent);","map":{"version":3,"names":["Component","ProfileComponent","constructor","route","user","payment","attendanceService","attonePresent","attoneAbsent","attoneLate","attendancePercentageAllMonths","attendancePercentageCurrentMonth","attendancePercentageAllMonthsPresent","attendancePercentageAllMonthsAbsent","attendancePercentageAllMonthsLate","attendancePercentageCurrentMonthPresent","attendancePercentageCurrentMonthAbsent","attendancePercentageCurrentMonthLate","data","attone","id","dataType","payments","ngOnInit","percentageattendance","params","subscribe","getUserById","next","student","getAllPayments","console","log","filter","userId","getAllAttendance","att","iduser","_id","currentDate","Date","currentMonth","getMonth","currentYear","getFullYear","atte","attDate","datenow","status","totalRecordsAllMonths","length","totalRecordsCurrentMonth","error","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\Mehdi\\Desktop\\Angular\\admin-School\\src\\app\\profile\\profile.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { IAttendance, Ipayment } from 'src/models';\nimport { UserService } from '../user.service';\nimport { PaymentService } from '../payment.service';\nimport { AttendanceService } from '../attendance.service';\n\n@Component({\n  selector: 'app-profile',\n  templateUrl: './profile.component.html',\n  styleUrls: ['./profile.component.css']\n})\nexport class ProfileComponent implements OnInit{\n  attonePresent: IAttendance[] = [];\n  attoneAbsent: IAttendance[] = [];\n  attoneLate: IAttendance[] = [];\n  attendancePercentageAllMonths: number = 0;\n  attendancePercentageCurrentMonth: number = 0;\n  attendancePercentageAllMonthsPresent: number = 0;\n  attendancePercentageAllMonthsAbsent: number = 0;\n  attendancePercentageAllMonthsLate: number = 0;\n  attendancePercentageCurrentMonthPresent: number = 0;\n  attendancePercentageCurrentMonthAbsent: number = 0;\n  attendancePercentageCurrentMonthLate: number = 0;\n  data: any = [];\n  attone: IAttendance[] = [];\n  id='';\n  dataType: String='';\n  payments:Ipayment[]=[];\n  constructor(private route:ActivatedRoute,private user:UserService,private payment:PaymentService,private attendanceService: AttendanceService){}\n  ngOnInit(): void {\n    this.percentageattendance();\n   // const id=this.route.snapshot.paramMap.get(\"id\");\n    this.route.params.subscribe(params => {\n      this.dataType = params['type'];\n      this.id=params['id'] // Will be 'student' or 'employee'\n    });\n  \n    this.user.getUserById(this.id).subscribe({\n      next:student => { this.data = student }\n     })\n     if (this.data==='Employee') {\n      this.payment.getAllPayments().subscribe((payment: Ipayment[]) => {\n        // Filter users by role 'employee'\n        console.log(this.payments);\n        this.payments = payment.filter(payment => payment.userId ===this.id)\n        \n        console.log(this.payments);\n        \n      });\n     } else {\n      this.payment.getAllPayments().subscribe((payment: Ipayment[]) => {\n        // Filter users by role 'student'\n        this.payments = payment.filter(payment => payment.userId ===this.id)\n        \n        console.log(this.payments);\n      });\n     }\n  }\n\n  percentageattendance() {\n    // Fetch all attendance records\n    this.attendanceService.getAllAttendance().subscribe(\n      (att: IAttendance[]) => {\n        // Handle the fetched attendance records here\n        this.attone = att.filter(att => att.iduser._id === this.id);\n  \n        // Filter records for the current month\n        const currentDate = new Date();\n        const currentMonth = currentDate.getMonth();\n        const currentYear = currentDate.getFullYear();\n        this.attonePresent = this.attone.filter(atte => {\n          const attDate = new Date(atte.datenow); // Use 'datenow' property for date filtering\n          return attDate.getMonth() === currentMonth && attDate.getFullYear() === currentYear && atte.status === 'present';\n        });\n  \n        this.attoneAbsent = this.attone.filter(atte => {\n          const attDate = new Date(atte.datenow); // Use 'datenow' property for date filtering\n          return attDate.getMonth() === currentMonth && attDate.getFullYear() === currentYear && atte.status === 'absent';\n        });\n  \n        this.attoneLate = this.attone.filter(atte => {\n          const attDate = new Date(atte.datenow); // Use 'datenow' property for date filtering\n          return attDate.getMonth() === currentMonth && attDate.getFullYear() === currentYear && atte.status === 'late';\n        });\n  \n        // Calculate attendance percentages\n        const totalRecordsAllMonths = this.attone.length;\n        const totalRecordsCurrentMonth = this.attonePresent.length + this.attoneAbsent.length + this.attoneLate.length;\n  \n        if (totalRecordsAllMonths > 0) {\n          this.attendancePercentageAllMonthsPresent = (this.attonePresent.length / totalRecordsAllMonths) * 100;\n          this.attendancePercentageAllMonthsAbsent = (this.attoneAbsent.length / totalRecordsAllMonths) * 100;\n          this.attendancePercentageAllMonthsLate = (this.attoneLate.length / totalRecordsAllMonths) * 100;\n        }\n  \n        if (totalRecordsCurrentMonth > 0) {\n          this.attendancePercentageCurrentMonthPresent = (this.attonePresent.length / totalRecordsCurrentMonth) * 100;\n          this.attendancePercentageCurrentMonthAbsent = (this.attoneAbsent.length / totalRecordsCurrentMonth) * 100;\n          this.attendancePercentageCurrentMonthLate = (this.attoneLate.length / totalRecordsCurrentMonth) * 100;\n        }\n  \n        console.log('Attendance Records for All Months:', this.attone);\n        console.log('Attendance Records for Current Month (Present):', this.attonePresent);\n        console.log('Attendance Records for Current Month (Absent):', this.attoneAbsent);\n        console.log('Attendance Records for Current Month (Late):', this.attoneLate);\n        console.log('Attendance Percentage for All Months (Present):', this.attendancePercentageAllMonthsPresent);\n        console.log('Attendance Percentage for All Months (Absent):', this.attendancePercentageAllMonthsAbsent);\n        console.log('Attendance Percentage for All Months (Late):', this.attendancePercentageAllMonthsLate);\n        console.log('Attendance Percentage for Current Month (Present):', this.attendancePercentageCurrentMonthPresent);\n        console.log('Attendance Percentage for Current Month (Absent):', this.attendancePercentageCurrentMonthAbsent);\n        console.log('Attendance Percentage for Current Month (Late):', this.attendancePercentageCurrentMonthLate);\n      },\n      (error) => {\n        console.error('Error fetching attendance records:', error);\n      }\n    );\n  }\n  \n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}